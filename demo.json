
interface Point {
  x: number;
  y: number;
}

interface Stroke {
  color: string;
  width: number;
  points: Point[];
}

interface ImageElement {
  id: string;
  src: string;
  x: number;
  y: number;
  width: number;
  height: number;
  rotation: number;
}

interface Page {
  strokes: Stroke[];
  images: ImageElement[];
}

interface Note {
  id: number | null;
  pages: Page[];
  thumbnail?: string;
  timestamp?: number;
}

interface HistoryState {
  pages: Page[];
}

type View = 'home' | 'editor';
type Tool = 'pen' | 'eraser';

export function DrawingNotesApp(): JSX.Element {
  const [currentView, setCurrentView
  ] = useState<View>('home');
  const [notes, setNotes
  ] = useState<Note[]>([]);
  const [currentNote, setCurrentNote
  ] = useState<Note | null>(null);
  const [selectedColor, setSelectedColor
  ] = useState<string>('#000000');
  const [selectedTool, setSelectedTool
  ] = useState<Tool>('pen');
  const [isDrawing, setIsDrawing
  ] = useState<boolean>(false);
  const [history, setHistory
  ] = useState<HistoryState[]>([]);
  const [historyIndex, setHistoryIndex
  ] = useState<number>(-1);
  const [selectedImage, setSelectedImage
  ] = useState<{ pageIndex: number; imageId: string
  } | null>(null);
  const [dragOffset, setDragOffset
  ] = useState<{ x: number; y: number
  } | null>(null);
  const [resizeHandle, setResizeHandle
  ] = useState<string | null>(null);
  const [rotateMode, setRotateMode
  ] = useState<boolean>(false);

  const canvasRefs = useRef<Map<number, HTMLCanvasElement>>(new Map());
  const fileInputRef = useRef<HTMLInputElement>(null);

  const colors: string[] = ['#000000', '#FF0000', '#0000FF', '#00FF00', '#FFFF00', '#FF00FF', '#00FFFF', '#FFA500'
  ];

  useEffect(() => {
    if (currentNote) {
      currentNote.pages.forEach((page, index) => {
        const canvas = canvasRefs.current.get(index);
        if (canvas) {
          const ctx = canvas.getContext('2d');
          if (ctx) {
            redrawCanvas(ctx, canvas, page);
          }
        }
      });
    }
  },
  [currentNote
  ]);

  const saveToHistory = (pages: Page[]): void => {
    const newHistory = history.slice(0, historyIndex + 1);
    newHistory.push({ pages: JSON.parse(JSON.stringify(pages))
    });
    setHistory(newHistory);
    setHistoryIndex(newHistory.length - 1);
  };

  const undo = (): void => {
    if (historyIndex > 0) {
      const newIndex = historyIndex - 1;
      setHistoryIndex(newIndex);
      setCurrentNote(prev => prev ? { ...prev, pages: JSON.parse(JSON.stringify(history[newIndex
        ].pages))
      } : null);
    }
  };

  const redo = (): void => {
    if (historyIndex < history.length - 1) {
      const newIndex = historyIndex + 1;
      setHistoryIndex(newIndex);
      setCurrentNote(prev => prev ? { ...prev, pages: JSON.parse(JSON.stringify(history[newIndex
        ].pages))
      } : null);
    }
  };

  const redrawCanvas = (ctx: CanvasRenderingContext2D, canvas: HTMLCanvasElement, page: Page): void => {
    ctx.clearRect(0,
    0, canvas.width, canvas.height);

    page.strokes.forEach(stroke => {
      ctx.strokeStyle = stroke.color;
      ctx.lineWidth = stroke.width;
      ctx.globalCompositeOperation = stroke.color === 'eraser' ? 'destination-out' : 'source-over';
      ctx.beginPath();
      stroke.points.forEach((point, index) => {
        if (index === 0) {
          ctx.moveTo(point.x, point.y);
        } else {
          ctx.lineTo(point.x, point.y);
        }
      });
      ctx.stroke();
    });
    ctx.globalCompositeOperation = 'source-over';
  };

  const getCanvasCoordinates = (e: React.MouseEvent | React.TouchEvent, canvas: HTMLCanvasElement) => {
    const rect = canvas.getBoundingClientRect();
    const clientX = 'touches' in e ? e.touches[
      0
    ]?.clientX : e.clientX;
    const clientY = 'touches' in e ? e.touches[
      0
    ]?.clientY : e.clientY;
    return {
      x: clientX - rect.left,
      y: clientY - rect.top
    };
  };

  const startDrawing = (e: React.MouseEvent<HTMLCanvasElement> | React.TouchEvent<HTMLCanvasElement>, pageIndex: number): void => {
    const canvas = canvasRefs.current.get(pageIndex);
    if (!canvas) return;

    const { x, y
    } = getCanvasCoordinates(e, canvas);

    setIsDrawing(true);
    const ctx = canvas.getContext('2d');
    if (!ctx) return;

    const strokeColor = selectedTool === 'eraser' ? 'eraser' : selectedColor;
    const strokeWidth = selectedTool === 'eraser' ? 20 : 3;

    ctx.strokeStyle = strokeColor;
    ctx.lineWidth = strokeWidth;
    ctx.globalCompositeOperation = selectedTool === 'eraser' ? 'destination-out' : 'source-over';
    ctx.beginPath();
    ctx.moveTo(x, y);

    setCurrentNote(prev => {
      if (!prev) return prev;
      const pages = JSON.parse(JSON.stringify(prev.pages));
      pages[pageIndex
      ].strokes.push({
        color: strokeColor,
        width: strokeWidth,
        points: [
          { x, y
          }
        ]
      });
      return { ...prev, pages
      };
    });
  };

  const draw = (e: React.MouseEvent<HTMLCanvasElement> | React.TouchEvent<HTMLCanvasElement>, pageIndex: number): void => {
    if (!isDrawing) return;

    e.preventDefault();
    const canvas = canvasRefs.current.get(pageIndex);
    if (!canvas) return;

    const { x, y
    } = getCanvasCoordinates(e, canvas);

    const ctx = canvas.getContext('2d');
    if (!ctx) return;

    ctx.lineTo(x, y);
    ctx.stroke();

    setCurrentNote(prev => {
      if (!prev) return prev;
      const pages = JSON.parse(JSON.stringify(prev.pages));
      const lastStroke = pages[pageIndex
      ].strokes[pages[pageIndex
        ].strokes.length - 1
      ];
      if (lastStroke) {
        lastStroke.points.push({ x, y
        });
      }
      return { ...prev, pages
      };
    });
  };

  const stopDrawing = (): void => {
    if (isDrawing && currentNote) {
      saveToHistory(currentNote.pages);
      setIsDrawing(false);
    }
  };

  const handleImageUpload = (e: React.ChangeEvent<HTMLInputElement>, pageIndex: number): void => {
    const file = e.target.files?.[
      0
    ];
    if (!file) return;

    const reader = new FileReader();
    reader.onload = (event) => {
      const img = new Image();
      img.onload = () => {
        const maxWidth = 300;
        const scale = maxWidth / img.width;
        const width = maxWidth;
        const height = img.height * scale;

        setCurrentNote(prev => {
          if (!prev) return prev;
          const pages = JSON.parse(JSON.stringify(prev.pages));
          pages[pageIndex
          ].images.push({
            id: Date.now().toString(),
            src: event.target?.result as string,
            x: 50,
            y: 50,
            width,
            height,
            rotation: 0
          });
          saveToHistory(pages);
          return { ...prev, pages
          };
        });
      };
      img.src = event.target?.result as string;
    };
    reader.readAsDataURL(file);

    if (fileInputRef.current) {
      fileInputRef.current.value = '';
    }
  };

  const startImageDrag = (e: React.MouseEvent | React.TouchEvent, pageIndex: number, imageId: string, handle?: string): void => {
    e.stopPropagation();
    const page = currentNote?.pages[pageIndex
    ];
    const image = page?.images.find(img => img.id === imageId);
    if (!image) return;

    const clientX = 'touches' in e ? e.touches[
      0
    ].clientX : e.clientX;
    const clientY = 'touches' in e ? e.touches[
      0
    ].clientY : e.clientY;

    setSelectedImage({ pageIndex, imageId
    });

    if (handle) {
      setResizeHandle(handle);
    } else {
      setDragOffset({
        x: clientX - image.x,
        y: clientY - image.y
      });
    }
  };

  const dragImage = (e: React.MouseEvent | React.TouchEvent): void => {
    if (!selectedImage) return;
    e.preventDefault();

    const clientX = 'touches' in e ? e.touches[
      0
    ].clientX : e.clientX;
    const clientY = 'touches' in e ? e.touches[
      0
    ].clientY : e.clientY;

    setCurrentNote(prev => {
      if (!prev) return prev;
      const pages = JSON.parse(JSON.stringify(prev.pages));
      const image = pages[selectedImage.pageIndex
      ].images.find((img: ImageElement) => img.id === selectedImage.imageId);

      if (!image) return prev;

      if (resizeHandle) {
        const canvas = canvasRefs.current.get(selectedImage.pageIndex);
        if (!canvas) return prev;
        const rect = canvas.getBoundingClientRect();
        const canvasX = clientX - rect.left;
        const canvasY = clientY - rect.top;

        if (resizeHandle === 'se') {
          const newWidth = Math.max(50, canvasX - image.x);
          const newHeight = Math.max(50, canvasY - image.y);
          image.width = newWidth;
          image.height = newHeight;
        } else if (resizeHandle === 'sw') {
          const newWidth = Math.max(50, image.x + image.width - canvasX);
          const newHeight = Math.max(50, canvasY - image.y);
          image.x = canvasX;
          image.width = newWidth;
          image.height = newHeight;
        } else if (resizeHandle === 'ne') {
          const newWidth = Math.max(50, canvasX - image.x);
          const newHeight = Math.max(50, image.y + image.height - canvasY);
          image.y = canvasY;
          image.width = newWidth;
          image.height = newHeight;
        } else if (resizeHandle === 'nw') {
          const newWidth = Math.max(50, image.x + image.width - canvasX);
          const newHeight = Math.max(50, image.y + image.height - canvasY);
          image.x = canvasX;
          image.y = canvasY;
          image.width = newWidth;
          image.height = newHeight;
        }
      } else if (rotateMode) {
        const centerX = image.x + image.width / 2;
        const centerY = image.y + image.height / 2;
        const canvas = canvasRefs.current.get(selectedImage.pageIndex);
        if (!canvas) return prev;
        const rect = canvas.getBoundingClientRect();
        const canvasX = clientX - rect.left;
        const canvasY = clientY - rect.top;
        const angle = Math.atan2(canvasY - centerY, canvasX - centerX);
        image.rotation = (angle * 180 / Math.PI) + 90;
      } else if (dragOffset) {
        const canvas = canvasRefs.current.get(selectedImage.pageIndex);
        if (!canvas) return prev;
        const rect = canvas.getBoundingClientRect();
        const canvasX = clientX - rect.left;
        const canvasY = clientY - rect.top;
        image.x = canvasX - dragOffset.x;
        image.y = canvasY - dragOffset.y;
      }

      return { ...prev, pages
      };
    });
  };

  const stopImageDrag = (): void => {
    if (selectedImage && currentNote) {
      saveToHistory(currentNote.pages);
    }
    setSelectedImage(null);
    setDragOffset(null);
    setResizeHandle(null);
    setRotateMode(false);
  };

  const deleteImage = (pageIndex: number, imageId: string): void => {
    setCurrentNote(prev => {
      if (!prev) return prev;
      const pages = JSON.parse(JSON.stringify(prev.pages));
      pages[pageIndex
      ].images = pages[pageIndex
      ].images.filter((img: ImageElement) => img.id !== imageId);
      saveToHistory(pages);
      return { ...prev, pages
      };
    });
  };

  const saveNote = (): void => {
    if (!currentNote?.pages.length) return;

    const canvas = canvasRefs.current.get(0);
    if (!canvas) return;

    const thumbnail = canvas.toDataURL('image/png');

    const noteToSave: Note = {
      id: currentNote.id || Date.now(),
      pages: currentNote.pages,
      thumbnail,
      timestamp: Date.now()
    };

    setNotes(prev => {
      const existing = prev.findIndex(n => n.id === noteToSave.id);
      if (existing !== -1) {
        const updated = [...prev
        ];
        updated[existing
        ] = noteToSave;
        return updated;
      }
      return [noteToSave, ...prev
      ];
    });

    alert('Note saved!');
  };

  const createNewNote = (): void => {
    const newNote = { id: null, pages: [
        { strokes: [], images: []
        }
      ]
    };
    setCurrentNote(newNote);
    setHistory([
      { pages: newNote.pages
      }
    ]);
    setHistoryIndex(0);
    setCurrentView('editor');
  };

  const openNote = (note: Note): void => {
    setCurrentNote(note);
    setHistory([
      { pages: JSON.parse(JSON.stringify(note.pages))
      }
    ]);
    setHistoryIndex(0);
    setCurrentView('editor');
  };

  const deleteNote = (id: number | null): void => {
    if (confirm('Delete this note?')) {
      setNotes(prev => prev.filter(n => n.id !== id));
    }
  };

  const clearPage = (pageIndex: number): void => {
    if (confirm('Clear this page?')) {
      setCurrentNote(prev => {
        if (!prev) return prev;
        const pages = JSON.parse(JSON.stringify(prev.pages));
        pages[pageIndex
        ] = { strokes: [], images: []
        };
        saveToHistory(pages);
        return { ...prev, pages
        };
      });
    }
  };

  const addNewPage = (): void => {
    setCurrentNote(prev => {
      if (!prev) return prev;
      const pages = [...prev.pages,
        { strokes: [], images: []
        }
      ];
      saveToHistory(pages);
      return { ...prev, pages
      };
    });
  };

  const deletePage = (pageIndex: number): void => {
    if (!currentNote || currentNote.pages.length <= 1) {
      alert('Cannot delete the last page!');
      return;
    }

    if (confirm('Delete this page?')) {
      setCurrentNote(prev => {
        if (!prev) return prev;
        const pages = prev.pages.filter((_, idx) => idx !== pageIndex);
        saveToHistory(pages);
        return { ...prev, pages
        };
      });
    }
  };

  if (currentView === 'home') {
    return (
      <div className="min-h-screen bg-gray-50 p-4">
        <div className="max-w-4xl mx-auto">
          <div className="flex justify-between items-center mb-6">
            <h1 className="text-3xl font-bold text-gray-800">My Notes</h1>
            <button
              onClick={createNewNote
    }
              className="bg-blue-500 text-white px-4 py-2 rounded-lg flex items-center gap-2 hover:bg-blue-600"
            >
              <Plus size={
      20
    } /> New Note
            </button>
          </div>

          {notes.length === 0 ? (
            <div className="text-center py-16">
              <Pencil size={
        64
      } className="mx-auto text-gray-300 mb-4" />
              <p className="text-gray-500 text-lg">No notes yet. Create your first note!</p>
            </div>
          ) : (
            <div className="grid grid-cols-2 md:grid-cols-3 gap-4">
              {notes.map(note => (
                <div
                  key={note.id
        }
                  className="bg-white rounded-lg shadow-md overflow-hidden cursor-pointer hover:shadow-lg transition-shadow"
                >
                  <div onClick={() => openNote(note)
        } className="relative pb-[75%]">
                    <img
                      src={note.thumbnail
        }
                      alt="Note"
                      className="absolute inset-0 w-full h-full object-cover"
                    />
                    <div className="absolute top-2 right-2 bg-black bg-opacity-60 text-white px-2 py-1 rounded text-xs">
                      {note.pages.length
        } page{note.pages.length !== 1 ? 's' : ''
        }
                    </div>
                  </div>
                  <div className="p-3 flex justify-between items-center">
                    <span className="text-sm text-gray-500">
                      {note.timestamp ? new Date(note.timestamp).toLocaleDateString() : ''
        }
                    </span>
                    <button
                      onClick={() => deleteNote(note.id)
        }
                      className="text-red-500 hover:text-red-700"
                    >
                      <Trash2 size={
          18
        } />
                    </button>
                  </div>
                </div>
              ))
      }
            </div>
          )
    }
        </div>
      </div>
    );
  }

  return (
    <div className="min-h-screen bg-gray-50 flex flex-col">
      <div className="bg-white shadow-md p-4">
        <div className="max-w-4xl mx-auto flex justify-between items-center">
          <button
            onClick={() => setCurrentView('home')
  }
            className="flex items-center gap-2 text-gray-700 hover:text-gray-900"
          >
            <Home size={
    20
  } /> Home
          </button>

          <div className="flex gap-2">
            <button
              onClick={undo
  }
              disabled={historyIndex <= 0
  }
              className={`px-3 py-2 rounded-lg flex items-center gap-1 ${
                historyIndex <= 0 ? 'bg-gray-200 text-gray-400 cursor-not-allowed' : 'bg-gray-200 text-gray-700 hover:bg-gray-300'
    }`
  }
            >
              <Undo size={
    20
  } />
            </button>
            <button
              onClick={redo
  }
              disabled={historyIndex >= history.length - 1
  }
              className={`px-3 py-2 rounded-lg flex items-center gap-1 ${
                historyIndex >= history.length - 1 ? 'bg-gray-200 text-gray-400 cursor-not-allowed' : 'bg-gray-200 text-gray-700 hover:bg-gray-300'
    }`
  }
            >
              <Redo size={
    20
  } />
            </button>
            <button
              onClick={saveNote
  }
              className="bg-green-500 text-white px-4 py-2 rounded-lg flex items-center gap-2 hover:bg-green-600"
            >
              <Save size={
    20
  } /> Save
            </button>
          </div>
        </div>
      </div>

      <div className="bg-white shadow-md p-4">
        <div className="max-w-4xl mx-auto">
          <div className="flex items-center gap-4 mb-3">
            <span className="text-sm font-medium text-gray-700">Tool:</span>
            <button
              onClick={() => setSelectedTool('pen')
  }
              className={`px-4 py-2 rounded-lg flex items-center gap-2 ${
                selectedTool === 'pen' ? 'bg-blue-500 text-white' : 'bg-gray-200 text-gray-700'
    }`
  }
            >
              <Pencil size={
    18
  } /> Pen
            </button>
            <button
              onClick={() => setSelectedTool('eraser')
  }
              className={`px-4 py-2 rounded-lg flex items-center gap-2 ${
                selectedTool === 'eraser' ? 'bg-blue-500 text-white' : 'bg-gray-200 text-gray-700'
    }`
  }
            >
              <Eraser size={
    18
  } /> Eraser
            </button>
          </div>

          {selectedTool === 'pen' && (
            <div className="flex items-center gap-2">
              <span className="text-sm font-medium text-gray-700">Colors:</span>
              {colors.map(color => (
                <button
                  key={color
      }
                  onClick={() => setSelectedColor(color)
      }
                  className={`w-8 h-8 rounded-full border-2 ${
                    selectedColor === color ? 'border-gray-800 scale-110' : 'border-gray-300'
        } transition-transform`
      }
                  style={
        { backgroundColor: color
        }
      }
                />
              ))
    }
            </div>
          )
  }
        </div>
      </div>

      <div className="flex-1 overflow-y-auto p-4">
        <div className="max-w-4xl mx-auto space-y-6" onMouseMove={dragImage
  } onMouseUp={stopImageDrag
  } onTouchMove={dragImage
  } onTouchEnd={stopImageDrag
  }>
          {currentNote?.pages.map((page, pageIndex) => (
            <div key={pageIndex
    } className="bg-white rounded-lg shadow-lg p-4">
              <div className="flex justify-between items-center mb-3">
                <span className="text-sm font-medium text-gray-700">Page {pageIndex + 1
    }</span>
                <div className="flex gap-2">
                  <input
                    ref={fileInputRef
    }
                    type="file"
                    accept="image/*"
                    onChange={(e) => handleImageUpload(e, pageIndex)
    }
                    className="hidden"
                    id={`image-upload-${pageIndex
      }`
    }
                  />
                  <label
                    htmlFor={`image-upload-${pageIndex
      }`
    }
                    className="bg-purple-500 text-white px-3 py-1 rounded text-sm cursor-pointer hover:bg-purple-600 flex items-center gap-1"
                  >
                    <ImageIcon size={
      16
    } /> Add Image
                  </label>
                  <button
                    onClick={() => clearPage(pageIndex)
    }
                    className="bg-orange-500 text-white px-3 py-1 rounded text-sm hover:bg-orange-600"
                  >
                    Clear
                  </button>
                  <button
                    onClick={() => deletePage(pageIndex)
    }
                    className="bg-red-500 text-white px-3 py-1 rounded text-sm hover:bg-red-600"
                  >
                    Delete
                  </button>
                </div>
              </div>

              <div className="relative bg-white shadow-xl" style={
      { width: '794px', height: '1123px', margin: '0 auto'
      }
    }>
                <canvas
                  ref={(el) => {
                    if (el) {
                      canvasRefs.current.set(pageIndex, el);
                      el.width = 794;
                      el.height = 1123;
                      const ctx = el.getContext('2d');
                      if (ctx) {
                        ctx.lineCap = 'round';
                        ctx.lineJoin = 'round';
                        redrawCanvas(ctx, el, page);
          }
        }
      }
    }
                  onMouseDown={(e) => startDrawing(e, pageIndex)
    }
                  onMouseMove={(e) => draw(e, pageIndex)
    }
                  onMouseUp={stopDrawing
    }
                  onMouseLeave={stopDrawing
    }
                  onTouchStart={(e) => startDrawing(e, pageIndex)
    }
                  onTouchMove={(e) => draw(e, pageIndex)
    }
                  onTouchEnd={stopDrawing
    }
                  className={`absolute inset-0 w-full ${
                    selectedTool === 'eraser' ? 'cursor-cell' : 'cursor-crosshair'
      } touch-none`
    }
                />

                {page.images.map(image => (
                  <div
                    key={image.id
      }
                    className="absolute cursor-move group"
                    style={
        {
                      left: `${image.x
          }px`,
                      top: `${image.y
          }px`,
                      width: `${image.width
          }px`,
                      height: `${image.height
          }px`,
                      transform: `rotate(${image.rotation
          }deg)`,
                      transformOrigin: 'center center'
        }
      }
                  >
                    <div
                      className="relative w-full h-full"
                      onMouseDown={(e) => startImageDrag(e, pageIndex, image.id)
      }
                      onTouchStart={(e) => startImageDrag(e, pageIndex, image.id)
      }
                    >
                      <img
                        src={image.src
      }
                        alt="Inserted"
                        className="w-full h-full object-contain border-2 border-blue-300 rounded"
                        draggable={
        false
      }
                      />

                      { /* Resize handles */}
                      <div
                        className="absolute -top-1 -left-1 w-3 h-3 bg-blue-500 rounded-full cursor-nw-resize opacity-0 group-hover:opacity-100"
                        onMouseDown={(e) => { e.stopPropagation(); startImageDrag(e, pageIndex, image.id, 'nw');
        }
      }
                        onTouchStart={(e) => { e.stopPropagation(); startImageDrag(e, pageIndex, image.id, 'nw');
        }
      }
                      />
                      <div
                        className="absolute -top-1 -right-1 w-3 h-3 bg-blue-500 rounded-full cursor-ne-resize opacity-0 group-hover:opacity-100"
                        onMouseDown={(e) => { e.stopPropagation(); startImageDrag(e, pageIndex, image.id, 'ne');
        }
      }
                        onTouchStart={(e) => { e.stopPropagation(); startImageDrag(e, pageIndex, image.id, 'ne');
        }
      }
                      />
                      <div
                        className="absolute -bottom-1 -left-1 w-3 h-3 bg-blue-500 rounded-full cursor-sw-resize opacity-0 group-hover:opacity-100"
                        onMouseDown={(e) => { e.stopPropagation(); startImageDrag(e, pageIndex, image.id, 'sw');
        }
      }
                        onTouchStart={(e) => { e.stopPropagation(); startImageDrag(e, pageIndex, image.id, 'sw');
        }
      }
                      />
                      <div
                        className="absolute -bottom-1 -right-1 w-3 h-3 bg-blue-500 rounded-full cursor-se-resize opacity-0 group-hover:opacity-100"
                        onMouseDown={(e) => { e.stopPropagation(); startImageDrag(e, pageIndex, image.id, 'se');
        }
      }
                        onTouchStart={(e) => { e.stopPropagation(); startImageDrag(e, pageIndex, image.id, 'se');
        }
      }
                      />

                      { /* Rotate handle */}
                      <div
                        className="absolute -top-8 left-1/2 -translate-x-1/2 w-6 h-6 bg-green-500 rounded-full cursor-grab opacity-0 group-hover:opacity-100 flex items-center justify-center text-white text-xs"
                        onMouseDown={(e) => { e.stopPropagation(); setRotateMode(true); startImageDrag(e, pageIndex, image.id);
        }
      }
                        onTouchStart={(e) => { e.stopPropagation(); setRotateMode(true); startImageDrag(e, pageIndex, image.id);
        }
      }
                      >
                        ↻
                      </div>

                      { /* Delete button */}
                      <button
                        onClick={() => deleteImage(pageIndex, image.id)
      }
                        className="absolute -top-2 -right-2 bg-red-500 text-white rounded-full w-6 h-6 flex items-center justify-center opacity-0 group-hover:opacity-100 transition-opacity z-10"
                      >
                        ×
                      </button>
                    </div>
                  </div>
                ))
    }
              </div>
            </div>
          ))
  }

          <button
            onClick={addNewPage
  }
            className="w-full bg-blue-500 text-white py-3 rounded-lg flex items-center justify-center gap-2 hover:bg-blue-600"
          >
            <Plus size={
    20
  } /> Add New Page
          </button>
        </div>
      </div>
    </div>
  );
}